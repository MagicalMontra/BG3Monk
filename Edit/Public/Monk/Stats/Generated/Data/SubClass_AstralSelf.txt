new entry "Astral_Arms_Passive"
type "PassiveData"
data "DisplayName" "Astral Arms"
data "Description" "Summon the arms of your Astral self to help you in combat."
data "Icon" "Icon_AstralArms"
data "Boosts" "UnlockSpell(Shout_AstralArms)"

new entry "Shout_AstralArms"
type "SpellData"
data "SpellType" "Shout"
data "SpellProperties" "ApplyStatus(ASTRALARMS,100,100);ApplyStatus(ASTRALARMSAOE,100,1)"
data "TargetConditions" "Self()"
data "Icon" "Icon_AstralArms"
data "DisplayName" "Astral Arms"
data "Description" "While you have your astral arms summoned you can attack with them using your wisdom modifier for attack and damage rolls, and your attacks with them have a 10ft reach and deal force damage. "
data "ExtraDescription" "While you have astrals arms active you can spend a ki point to activate your astral visage if you have it."
data "TooltipStatusApply" "ApplyStatus(ASTRALARMS,100,100)"
data "CastTextEvent" "Cast"
data "CastSound" "Spell_Cast_Buff_Blur_L1to3"
data "VocalComponentSound" "Vocal_Component_Disadvantage"
data "TargetSound" "Spell_Impact_Buff_Blur_L1to3"
data "UseCosts" "BonusActionPoint:1;KiPoint:1"
data "SpellAnimation" "03496c4a-49e0-4132-b585-3e5ecd1ad8e5(SPL_Arcane_Buff_01_Prepare),,;,,;bcc3b0d9-f04f-4448-aab0-e0ad641167cc(SPL_Somatic_Self_01_Cast),,;bf924cc6-8b39-4c3b-b1c0-eda264cf6150(SPL_Somatic_Self_01_Recover),,;a9682ef9-5d9e-4ac0-8144-2c7fe6eb868c(SPL_Arcane_Buff_01_Loop),,;,,"
data "VerbalIntent" "Buff"
data "SpellFlags" "IsASpell"
data "HitAnimationType" "MagicalNonDamage"
data "PrepareEffect" "33302a46-4a12-41dd-8845-6b7314d50022"
data "CastEffect" "1a4b0423-005b-4577-b376-815a08809675"

//data "SpellProperties" "ApplyStatus(ASTRALARMS,100,100);CreateExplosion(Projectile_AstralArms)"//

new entry "ASTRALARMS"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Astral Arms"
data "StackId" "ASTRALARMS"
data "Boosts" "UnlockSpell(Target_AstralStrike);UnlockSpell(Target_AstralBonusStrike)"

new entry "ASTRALARMSAOE"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Astral Arms: AOE"
data "StackId" "ASTRALARMSAOE"
data "Boosts" "UnlockSpell(Projectile_AstralArmsAOE)"

new entry "Target_AstralStrike"
type "SpellData"
data "SpellType" "Target"
data "TargetCeiling" "0"
data "TargetFloor" ".25"
data "TargetRadius" "4"
data "SpellRoll" "Attack(AttackType.MeleeSpellAttack)"
data "SpellSuccess" "IF(not HasStatus('ASTRALBODY',context.Source) and LevelLessThan(5)):DealDamage(1d4+WisdomModifier,Force);IF(not HasStatus('ASTRALBODY',context.Source) and CharacterLevelGreaterThan(4)):DealDamage(ResourceRoll(MartialArtsDie,1) + WisdomModifier, Force);IF(HasStatus('ASTRALBODY',context.Source) and LevelLessThan(5)):DealDamage(2d4+WisdomModifier,Force);IF(HasStatus('ASTRALBODY',context.Source) and CharacterLevelGreaterThan(4)):DealDamage(ResourceRoll(MartialArtsDie,2) + WisdomModifier, Force)"
data "TargetConditions" "not Self() and not Dead()"
data "Icon" "Icon_AstralStrike"
data "DisplayName" "Astral Strike"
data "Description" "Your unarmed strikes use your Wisdom modifier, have a reach of 10ft, and deal force damage."
data "DescriptionParams" "DealDamage(1d4 + WisdomModifier, Bludgeoning)"
data "TooltipDamageList" "DealDamage(1d4 + WisdomModifier, Bludgeoning)"
data "TooltipAttackSave" "MeleeSpellAttack"
data "PreviewCursor" "Melee"
data "CastTextEvent" "Cast"
data "CastSound" "Action_Cast_Bash"
data "TargetSound" "Action_Impact_Bash"
data "CycleConditions" "Character() and not Dead()"
data "UseCosts" "ActionPointGroup:1"
data "SpellAnimation" "8b8bb757-21ce-4e02-a2f3-97d55cf2f90b(CMBT_Melee_RHand_01_Prepare),,;6606c30b-be1c-4f17-ae6b-1a591c80b18c(CMBT_Melee_RHand_01_Antic),366693ee-d97f-4294-a4dd-a2145ddc4e6a(CMBT_Melee_RHand_01_Antic_LOW),9f2d32b9-529a-4b75-b3df-6e1ae1395280(CMBT_Melee_RHand_01_Antic_HIGH);f4ac302b-1569-404f-bd52-1fe443e265df(CMBT_Melee_RHand_01_Attack),479ee5da-2967-41e1-b7d1-a94e864a5f25(CMBT_Melee_RHand_01_Attack_LOW),79323098-edb3-4993-ba50-9b5f705e9878(CMBT_Melee_RHand_01_Attack_HIGH);e8a5c57f-855b-4227-acaa-11e8ce8d7d64(CMBT_Melee_RHand_01_Recover),b5cb923d-0c08-4c20-89a9-44b9bf98c6cb(CMBT_Melee_RHand_01_Recover_LOW),6282d127-0c06-4365-9d53-6f32ef350127(CMBT_Melee_RHand_01_Recover_HIGH);7bb52cd4-0b1c-4926-9165-fa92b75876a3(CMBT_Melee_RHand_01_Loop),,;2b81c18b-9698-4262-a623-932c2bb1296d(CMBT_Melee_RHand_01_Dash),ecbf9949-3b33-432c-b735-e47aaed0924a(CMBT_Melee_RHand_01_Dash_LOW),e71a7c08-fdc1-4a0b-9a90-1c793c58553c(CMBT_Melee_RHand_01_Dash_HIGH)"
data "SpellFlags" "IsMelee;IsHarmful;DontForceSheathOrUnsheath;IgnoreSilence"
data "HitAnimationType" "PhysicalDamage"
data "SpellAnimationIntentType" "Aggressive"

new entry "Target_AstralBonusStrike"
type "SpellData"
data "SpellType" "Target"
using "Target_AstralStrike"
data "Icon" "Icon_AstralBonusStrike"
data "SpellRoll" "Attack(AttackType.MeleeSpellAttack)"
data "SpellSuccess" "IF(LevelLessThan(5)):DealDamage(1d4+WisdomModifier,Force);IF(CharacterLevelGreaterThan(4)):DealDamage(ResourceRoll(MartialArtsDie,1) + WisdomModifier, Force)"
data "DisplayName" "Bonus Astral Strike"
data "Description" "Strike a target with your offhand Astral Arm."
data "DescriptionParams" "DealDamage(WisdomModifier, Force)"
data "TooltipDamageList" "DealDamage(WisdomModifier, Force)"
data "TooltipAttackSave" "MeleeWeaponAttack"
data "UseCosts" "BonusActionPoint:1"
data "SpellFlags" "IsMelee;IsHarmful"


new entry "Projectile_AstralArmsAOE"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_Fireball"
data "Level" "0"
data "SpellProperties" "RemoveStatus(SELF,ASTRALARMSAOE)"
data "AreaRadius" "3"
data "Icon" "Icon_AstralBonusStrike"
data "ExplodeRadius" "3"
data "TargetConditions" "Enemy() and not Dead()"
data "DisplayName" "Astral Arms: AOE"
data "Description" "As a bonus action, you can spend 1 ki point to summon the arms of your astral self. When you do so, each creature of your choice that you can see within 10 feet of you must succeed on a Dexterity saving throw or take force damage equal to two rolls of your Martial Arts die."
data "DescriptionParams" "DealDamage(2d4, Force)"
data "TooltipDamageList" "DealDamage(2d4, Force)"
data "SpellRoll" "not SavingThrow(Ability.Dexterity, SourceSpellDC())"
data "SpellSuccess" "DealDamage(2d4,Force)"
data "SpellFail" ""
data "Template" "820c9654-3d56-405e-bdba-81ca7f3f5953"
data "Trajectories" "820c9654-3d56-405e-bdba-81ca7f3f5953,34a221b7-14c2-6a28-b5c0-744922974188,c26128c1-d076-ce28-e072-b0cb45cca45f"
data "UseCosts" ""
data "HitAnimationType" "MagicalDamage_External"


new entry "Astral_Visage_Passive"
type "PassiveData"
data "DisplayName" "Astral Visage"
data "Description" "Summon the visage of your Astral self."
data "Icon" "Icon_Astral_Visage"
data "Boosts" "UnlockSpell(Shout_AstralVisage)"

new entry "Shout_AstralVisage"
type "SpellData"
data "SpellType" "Shout"
data "SpellProperties" "ApplyStatus(ASTRALVISAGE,100,100)"
data "TargetConditions" "Self()"
data "Icon" "Icon_AstralVisage"
data "DisplayName" "Astral Visage"
data "Description" "You gain darkvision out to a range of 120ft and have advantage on insight and intimidation checks."
data "TooltipStatusApply" "ApplyStatus(ASTRALVISAGE,100,100)"
data "CastTextEvent" "Cast"
data "CastSound" "Spell_Cast_Buff_Blur_L1to3"
data "VocalComponentSound" "Vocal_Component_Disadvantage"
data "TargetSound" "Spell_Impact_Buff_Blur_L1to3"
data "UseCosts" "KiPoint:1"
data "SpellAnimation" "03496c4a-49e0-4132-b585-3e5ecd1ad8e5(SPL_Arcane_Buff_01_Prepare),,;,,;bcc3b0d9-f04f-4448-aab0-e0ad641167cc(SPL_Somatic_Self_01_Cast),,;bf924cc6-8b39-4c3b-b1c0-eda264cf6150(SPL_Somatic_Self_01_Recover),,;a9682ef9-5d9e-4ac0-8144-2c7fe6eb868c(SPL_Arcane_Buff_01_Loop),,;,,"
data "VerbalIntent" "Buff"
data "SpellFlags" "IsASpell"
data "HitAnimationType" "MagicalNonDamage"
data "PrepareEffect" "33302a46-4a12-41dd-8845-6b7314d50022"
data "CastEffect" "1a4b0423-005b-4577-b376-815a08809675"
data "RequirementConditions" "HasStatus('ASTRALARMS',context.Source)"

new entry "ASTRALVISAGE"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Astral Visage"
data "Boosts" "DarkvisionRangeMin(40);SourceAdvantage(Skill,Insight);SourceAdvantage(Skill,Intimidation);ActiveCharacterLight(233033a1-b43a-4ad9-976a-8a062b345e21)"

new entry "Astral_Body_Passive"
type "PassiveData"
data "DisplayName" "Astral Body"
data "Description" "Summon the body of your Astral self to help you in combat."
data "Icon" "Icon_AstralBody"
data "EnabledConditions" "HasStatus('ASTRALARMS') and HasStatus('ASTRALVISAGE')"
data "EnabledContext" "OnCastResolved;OnLongRest"
data "Properties" "IsToggled;ToggledDefaultAddToHotbar"
data "ToggleOnFunctors" "ApplyStatus(DE_TOGGLE,100,-1)"
data "ToggleOffFunctors" "RemoveStatus(DE_TOGGLE)"

new entry "DE_TOGGLE"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "DE_TOGGLE"
data "Description" "Gain resistance to energy damage once per turn."
data "Icon" "Unknown"
data "TickType" "StartTurn"
data "TickFunctors" "ApplyStatus(DEFLECTENERGY,100,1)"
data "StatusPropertyFlags" "DisableOverhead;DisablePortraitIndicator;DisableCombatLog;IgnoreResting"
data "OnApplyFunctors" "ApplyStatus(DEFLECTENERGY,100,1)"
data "OnRemoveFunctors" "RemoveStatus(DEFLECTENERGY)"
data "StatusPropertyFlags" "DisableCombatLog;DisablePortraitIndicator;DisableOverhead;ApplyToDead;IgnoreResting"

new entry "DEFLECTENERGY"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Deflect Energy" 
data "Description" "Gain resistance to energy damage once per turn"
data "Boosts" "Resistance(Cold, Resistant);Resistance(Fire, Resistant);Resistance(Acid, Resistant);Resistance(Lightning, Resistant);Resistance(Thunder, Resistant);Resistance(Force, Resistant)"
data "RemoveConditions" "HasDamageEffectFlag(DamageFlags.Hit) and HasDamageDoneForType(DamageType.Acid) or HasDamageDoneForType(DamageType.Cold) or HasDamageDoneForType(DamageType.Fire) or HasDamageDoneForType(DamageType.Lightning) or HasDamageDoneForType(DamageType.Thunder) or HasDamageDoneForType(DamageType.Force)"
data "RemoveEvents" "OnDamage"
data "StatusPropertyFlags" "DisableCombatLog;DisablePortraitIndicator;DisableOverhead;ApplyToDead;IgnoreResting"
//new entry "AgileParry"
//type "PassiveData"
//data "DisplayName" "Agile Parry"
//data "Description" "While you have your kensei weapon equipped if you make an unarmed attack on your turn you gain a +2 to AC until the start of your next turn."
//data "Icon" "Icon_AgileParry"
//data "Conditions" "SpellId('Target_MartialArts') or IsUnarmedAttack()"
//data "StatsFunctors" "ApplyStatus(SELF,AGILEPARRY,100,1)"
//data "StatsFunctorContext" "OnAttack"

new entry "AgileParry"
type "PassiveData"
data "DisplayName" "Agile Parry"
data "Description" "While you have your kensei weapon equipped if you make an unarmed attack on your turn you gain a +2 to AC until the start of your next turn."
data "Icon" "Icon_AgileParry"
data "Conditions" "SpellId('Target_MartialArts')"
data "StatsFunctors" "ApplyStatus(SELF,AGILEPARRY,100,1)"
data "StatsFunctorContext" "OnAttack"

new entry "MAGICAL_KENSEI_DEX"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Magic Kensei Weapons"
data "Description" "You are chanelling your ki into your kensei weapon, making it deal force damage on attack."
data "Icon" "Target_MainHandAttack"
data "StackId" "MAGICAL_KENSEI"
data "StackPriority" "0"
data "Boosts" "UnlockSpell(Target_DeftStrike_Melee,,,,Dexterity);UnlockSpell(Target_DeftStrike_Ranged,,,,Dexterity);RemoveStatus(SELF,MAGICAL_KENSEI_STR)"
data "StatusPropertyFlags" "DisableOverhead;ApplyToDead;IgnoreResting"
data "OnApplyFunctors" "IF(CharacterLevelGreaterThan(6) and HasStatus('KENSEIWEAPON',GetActiveWeapon()):RemoveStatus(SELF,MARTS_STR)"

new entry "MAGICAL_KENSEI_STR"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Magic Kensei Weapons"
data "Description" "You are chanelling your ki into your kensei weapon, making it deal force damage on attack."
data "Icon" "Target_MainHandAttack"
data "StackId" "MAGICAL_KENSEI"
data "StackPriority" "0"
data "Boosts" "UnlockSpell(Target_DeftStrike_Melee,,,,Strength);UnlockSpell(Target_DeftStrike_Ranged,,,,Strength);RemoveStatus(SELF,MAGICAL_KENSEI_DEX)"
data "StatusPropertyFlags" "DisableOverhead;ApplyToDead;IgnoreResting"
data "OnApplyFunctors" "IF(CharacterLevelGreaterThan(6) and HasStatus('KENSEIWEAPON',GetActiveWeapon()):RemoveStatus(SELF,MARTS_DEX)"

new entry "Target_DeftStrike_Melee"
type "SpellData"
data "SpellType" "Target"
data "TargetCeiling" "0"
data "TargetFloor" ".25"
data "TargetRadius" "MeleeMainWeaponRange"
data "SpellRoll" "Attack(AttackType.MeleeSpellAttack)"
data "SpellSuccess" "IF(CharacterLevelGreaterThan(6) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(10)):DealDamage(1d6+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(4) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThanLessThan(10)):DealDamage(1d6+StrengthModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+StrengthModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+StrengthModifier+MainMeleeWeapon,Force)"
data "TargetConditions" "not Self() and not Dead()"
data "Icon" "Target_MainHandAttack"
data "DisplayName" "Melee Deft Strike"
data "Description" "Spend 1 ki point to attack with your melee kensei weapon."
data "DescriptionParams" "IF(CharacterLevelGreaterThan(6) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(10)):DealDamage(1d6+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(4) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThanLessThan(10)):DealDamage(1d6+StrengthModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+StrengthModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+StrengthModifier+MainMeleeWeapon,Force)"
data "TooltipDamageList" "IF(CharacterLevelGreaterThan(6) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(10)):DealDamage(1d6+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+DexterityModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(4) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThanLessThan(10)):DealDamage(1d6+StrengthModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+StrengthModifier+MainMeleeWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+StrengthModifier+MainMeleeWeapon,Force)"
data "TooltipAttackSave" "MeleeSpellAttack"
data "PreviewCursor" "Melee"
data "CastTextEvent" "Cast"
data "TargetSound" "Action_Impact_Bash"
data "RequirementConditions" "HasStatus('KENSEIWEAPON',GetActiveWeapon())"
data "CycleConditions" "Character() and Enemy() and not Dead()"
data "UseCosts" "KiPoint:1"
data "SpellAnimation" "8b8bb757-21ce-4e02-a2f3-97d55cf2f90b,,;6606c30b-be1c-4f17-ae6b-1a591c80b18c,366693ee-d97f-4294-a4dd-a2145ddc4e6a,9f2d32b9-529a-4b75-b3df-6e1ae1395280;f4ac302b-1569-404f-bd52-1fe443e265df,479ee5da-2967-41e1-b7d1-a94e864a5f25,79323098-edb3-4993-ba50-9b5f705e9878;e8a5c57f-855b-4227-acaa-11e8ce8d7d64,b5cb923d-0c08-4c20-89a9-44b9bf98c6cb,6282d127-0c06-4365-9d53-6f32ef350127;7bb52cd4-0b1c-4926-9165-fa92b75876a3,,;2b81c18b-9698-4262-a623-932c2bb1296d,ecbf9949-3b33-432c-b735-e47aaed0924a,e71a7c08-fdc1-4a0b-9a90-1c793c58553c;0b07883a-08b8-43b6-ac18-84dc9e84ff50,,;,,;,,"
data "WeaponTypes" "Melee"
data "SpellFlags" "IsAttack;IsMelee;IsHarmful"
data "HitAnimationType" "PhysicalDamage"
data "SpellAnimationIntentType" "Aggressive"
data "CastEffect" "8682067a-e523-40fb-b705-3112083b6b05"
data "SpellSoundMagnitude" "None"
data "Cooldown" "OncePerTurn"

new entry "Target_DeftStrike_Ranged"
type "SpellData"
data "SpellType" "Projectile"
data "SpellProperties" "GROUND:DealDamage(MainRangedWeapon, MainRangedWeaponDamageType);GROUND:ExecuteWeaponFunctors(MainHand);IF(not Player(context.Source)):ApplyStatus(SELF,AI_HELPER_EXTRAATTACK,100,1);;CastOffhand[GROUND:DealDamage(OffhandRangedWeapon,OffhandRangedWeaponDamageType);GROUND:ExecuteWeaponFunctors(OffHand)]"
data "TargetFloor" "-1"
data "TargetRadius" "RangedMainWeaponRange"
data "SpellRoll" "Attack(AttackType.RangedWeaponAttack)"
data "SpellSuccess" "IF(CharacterLevelGreaterThan(6) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(10)):DealDamage(1d6+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(4) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThanLessThan(10)):DealDamage(1d6+StrengthModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+StrengthModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+StrengthModifier+MainRangedWeapon,Force)"
data "TargetConditions" "not Self() and not Dead()"
data "ProjectileCount" "1"
data "Trajectories" "ff93ba9c-124c-454e-ac8c-436c136bcef2,75d615be-9277-6e22-6c17-fa51981d7560,8c00238b-549d-dc71-8fcb-42ba68bae142"
data "Icon" "Projectile_MainHandAttack"
data "DisplayName" "Ranged Deft Strike"
data "Description" "Spend 1 ki point to attack with your ranged kensei weapon."
data "DescriptionParams" "IF(CharacterLevelGreaterThan(6) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(10)):DealDamage(1d6+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(4) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThanLessThan(10)):DealDamage(1d6+StrengthModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+StrengthModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+StrengthModifier+MainRangedWeapon,Force)"
data "TooltipDamageList" "IF(CharacterLevelGreaterThan(6) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(10)):DealDamage(1d6+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_DEX',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+DexterityModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(4) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThanLessThan(10)):DealDamage(1d6+StrengthModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(10) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and not CharacterLevelGreaterThan(16)):DealDamage(1d8+StrengthModifier+MainRangedWeapon,Force);IF(CharacterLevelGreaterThan(16) and HasStatus('MARTS_STR',context.Source) and HasStatus('KENSEIWEAPON',GetActiveWeapon())):DealDamage(1d10+StrengthModifier+MainRangedWeapon,Force)"
data "TooltipAttackSave" "RangedWeaponAttack"
data "PreviewCursor" "Bow"
data "CastTextEvent" "Cast"
data "RequirementConditions" "HasStatus('KENSEIWEAPON',GetActiveWeapon())"
data "CycleConditions" "Enemy() and not Dead()"
data "UseCosts" "KiPoint:1"
data "SpellAnimation" "73afb4e5-8cfe-4479-95cf-16889597fee3,,;7e67bfd0-2fc2-4d10-bed5-cfda9e660de5,,;eb054308-7fce-4b85-bf4c-7a0031fda7ac,,;0b0dc35b-4953-45c0-a9eb-8d3fef5e798a,,;6ec808e1-e128-44ef-9361-a713bf86de8f,,;b2e9c771-3497-444c-b360-23b4441985a1,,;f920a0a6-f257-4ce4-8d17-2dcaa7bb7bbb,,;,,;,,"
data "DualWieldingSpellAnimation" "73afb4e5-8cfe-4479-95cf-16889597fee3,,;7e67bfd0-2fc2-4d10-bed5-cfda9e660de5,,;eb054308-7fce-4b85-bf4c-7a0031fda7ac,,:4a789a60-04b8-4a26-b476-65cf26ca558b,,;a11b8bcb-ba24-417a-aa86-4e4379c41ee2,,;6ec808e1-e128-44ef-9361-a713bf86de8f,,;b2e9c771-3497-444c-b360-23b4441985a1,,;f920a0a6-f257-4ce4-8d17-2dcaa7bb7bbb,,;,,;,,"
data "SpellFlags" "IsAttack;HasHighGroundRangeExtension;RangeIgnoreVerticalThreshold;IsHarmful"
data "HitAnimationType" "PhysicalDamage"
data "SpellAnimationIntentType" "Aggressive"
data "SpellSoundMagnitude" "None"
data "Cooldown" "OncePerTurn"


// Original
//data "Conditions" "IsUnarmedAttack() and HasStatus('KENSEIWEAPON',GetActiveWeapon())"//

new entry "AGILEPARRY"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Agile Parry"
data "Description" "You are using your kensei weapon to defend yourself."
data "Icon" "Icon_AgileParry"
data "Boosts" "AC(2)"
data "StatusPropertyFlags" "DisableCombatLog;ApplyToDead;IgnoreResting"

//data "RemoveConditions" "not HasStatus('KENSEIWEAPON',GetActiveWeapon()"//
//data "RemoveEvents" "OnEquip;OnUnequip"//

new entry "KenseiShot"
type "PassiveData"
data "DisplayName" "Kensei's Shot"
data "Description" "Deal 1d4 additional weapons damage when you attack with a ranged Kensei weapon and spend a bonus action"
data "Icon" "Action_Steady"
data "Properties" "IsToggled;ToggledDefaultAddToHotbar;ToggledDefaultOn;OncePerTurn"
data "Conditions" "IsAttackType(AttackType.RangedWeaponAttack) and (HasDamageEffectFlag(DamageFlags.Hit) or HasDamageEffectFlag(DamageFlags.Critical)) and not (IsCriticalMiss() or IsMiss()) and HasStatus('KENSEIWEAPON',GetActiveWeapon()) and HasActionResource('BonusActionPoint', 1, 0, false, context.Source)"
data "StatsFunctors" "UseActionResource(SELF,BonusActionPoint,1);DealDamage(1d4,MainRangedWeaponDamageType)"
data "StatsFunctorContext" "OnAttack"



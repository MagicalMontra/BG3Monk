new entry "Passive_DeflectMissiles"
type "PassiveData"
data "DisplayName" "Deflect Missiles"
data "Description" "While enabled spend your reaction to deflect the first ranged attack aimed at you each turn."
data "Icon" "Spell_Abjuration_BladeWard"
data "Conditions" "HasActionResource('ReactionActionPoint',1,0,false,context.Source) and Enemy()"
data "Properties" "IsToggled;ToggledDefaultAddToHotbar"
data "StatsFunctors" "RemoveAuraByChildStatus(REFLECTMISSILE);IF(TurnBased(context.Source)):UseActionResource(SELF,ReactionActionPoint,1)"
data "StatsFunctorContext" "OnAttacked"
data "ToggleOnFunctors" "ApplyStatus(DM_TOGGLE,100,-1)"
data "ToggleOffFunctors" "RemoveStatus(DM_TOGGLE)"

new entry "DM_TOGGLE"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "DM_TOGGLE"
data "Description" "When targeted with a ranged attack you will spend a reaction point to deflect the attack."
data "Properties" "IsHidden"
data "Icon" "Spell_Abjuration_BladeWard"
data "TickFunctors" "ApplyStatus(DMSTATUS_AURA,100,1);ApplyStatus(REFLECTMISSILE,100,1)"
data "OnApplyFunctors" "ApplyStatus(DMSTATUS_AURA,100,1);ApplyStatus(REFLECTMISSILE,100,1)"
data "OnRemoveFunctors" "RemoveStatus(DMSTATUS_AURA);RemoveStatus(REFLECTMISSILE)"
data "StatusPropertyFlags" "DisableOverhead;DisablePortraitIndicator;DisableCombatLog;IgnoreResting"


new entry "DMSTATUS_AURA"
type "StatusData"
data "StatusType" "BOOST"
data "Properties" "IsHidden"
data "DisplayName" "Deflect Missiles"
data "Description" "You will deflect the next ranged attack that doesn't miss you, causing it to deal 1d10+Level+Dexterity modifier less damage"
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS_AURA"
data "AuraRadius" "40"
data "AuraStatuses" "IF(Enemy() and HasActionResource('ReactionActionPoint',1,0,false,context.Source)):ApplyStatus(DMSTATUS,100,1)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "REFLECTMISSILE"
type "StatusData"
data "StatusType" "BOOST"
data "Properties" "IsHidden"
data "DisplayName" "Reflect Missile"
data "Description" "If you reduce the damage of a ranged attack to 0 with deflect missiles you can attack the target back with the ranged projectile."
data "Icon" "Projectile_MainHandAttack"
data "StackId" "REFLECTMISSILE"
data "Passives" "Passive_ReflectMissile"
data "RemoveConditions" "IsAttackType(AttackType.RangedWeaponAttack) and HasDamageEffectFlag(DamageFlags.Hit)"
data "RemoveEvents" "OnAttacked"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"
data "StatusEffect" "19c84d1e-8de6-4361-88ec-0f64c15d52b1"

new entry "Passive_ReflectMissile"
type "PassiveData"
data "DisplayName" "Return Missiles"
data "Description" "If you reduce the damage of a ranged attack to 0 with deflect missiles you can attack the target back with the ranged projectile."
data "Properties" "IsHidden"
data "Icon" "Spell_Abjuration_BladeWard"
data "Conditions" "IsAttackType(AttackType.RangedWeaponAttack) and ConditionResult(context.HitDescription.TotalDamageDone < 1)"
data "StatsFunctors" "UseAttack(SWAP)"
data "StatsFunctorContext" "OnAttacked"

new entry "Projectile_ReflectMissile"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_MainHandAttack"
data "SpellSuccess" "DealDamage(MainRangedWeapon), MainRangedWeaponDamageType);"
data "DisplayName" "Return Missile"
data "UseCosts" ""

new entry "DMSTATUS"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff"
data "Description" "The next ranged attack against the Monk will be deflected"
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS1"
data "OnRemoveFunctors" "IF(RemoveCause(StatusRemoveCause.External)):RemoveStatus(SELF,DMSTATUS_AURA)"
data "Passives" "DeflectMissile_Enemy"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DeflectMissile_Enemy"
type "PassiveData"
data "Properties" "IsHidden"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(-1d10)"
data "Conditions" "IsAttackType(AttackType.RangedWeaponAttack) and HasDamageEffectFlag(DamageFlags.Hit) and HasStatus('DMSTATUS_AURA',context.Target)"
data "StatsFunctors" "RemoveStatus(SELF,DMSTATUS)"
data "StatsFunctorContext" "OnAttack"

new entry "DMSTATUS_4"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -4"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--4)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DMSTATUS_5"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -5"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--5)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DMSTATUS_6"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -6"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--6)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DMSTATUS_7"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -7"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--7)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DMSTATUS_8"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -8"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--8)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DMSTATUS_9"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -9"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--9)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DMSTATUS_10"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -10"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--10)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DMSTATUS_11"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -11"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "StackId" "DMSTATUS"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--11)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"

new entry "DMSTATUS_12"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Damage Debuff -12"
data "Description" "Your next attack against the Monk will be deflected."
data "Icon" "Spell_Abjuration_BladeWard"
data "Boosts" "IF(IsAttackType(AttackType.RangedWeaponAttack) and HasStatus('DMSTATUS_AURA',context.Target)):CharacterWeaponDamage(--12)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatLog;DisablePortraitIndicator"
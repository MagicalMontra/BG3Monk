new entry "OpenHandOptions"
type "PassiveData"
data "DisplayName" "Open Hand Technique"
data "Description" "Toggle to set Flurry to knock the target prone, push the target away or prevent the target from taking reactions."
data "Icon" "Icon_OpenHand_Monk"
data "Properties" "IsToggled;ToggledDefaultAddToHotbar;ToggledDefaultOn"
data "ToggleOnFunctors" "IF(HasStatus('FLURRY_PUSH',context.Source)):ApplyStatus(FLURRY_BONK,100,-1);IF(HasStatus('FLURRY_BONK',context.Source)):ApplyStatus(FLURRY_PRONE,100,-1);IF(HasStatus('FLURRY_PRONE',context.Source)):ApplyStatus(FLURRY_PUSH,100,-1);IF(not HasStatus('FLURRY_PUSH',context.Source) and not HasStatus('FLURRY_BONK',context.Source) and not HasStatus('FLURRY_PRONE',context.Source)):ApplyStatus(FLURRY_PUSH,100,-1)"
data "ToggleOffFunctors" "IF(HasStatus('FLURRY_PUSH',context.Source)):ApplyStatus(FLURRY_BONK,100,-1);IF(HasStatus('FLURRY_BONK',context.Source)):ApplyStatus(FLURRY_PRONE,100,-1);IF(HasStatus('FLURRY_PRONE',context.Source)):ApplyStatus(FLURRY_PUSH,100,-1);IF(not HasStatus('FLURRY_PUSH',context.Source) and not HasStatus('FLURRY_BONK',context.Source) and not HasStatus('FLURRY_PRONE',context.Source)):ApplyStatus(FLURRY_PUSH,100,-1)"

new entry "OpenHandTechnique"
type "PassiveData"
data "DisplayName" "Open Hand Technique"
data "Description" "Manipulate your enemy's ki when you harness your own. Whenever you hit a creature with one of the attacks granted by your Flurry of Blows, you can impose an effect on the target."
data "Properties" "OncePerTurn;IsHidden"
data "Conditions" "(SpellId('Target_Flurry_Strike') or SpellId('Target_MartialArts_FreeBonusAttack')) and HasDamageEffectFlag(DamageFlags.Hit)"
data "StatsFunctors" "IF(HasStatus('FLURRY_PUSH',context.Source) and not SavingThrow(Ability.Strength, SourceSpellDC())):Force(4.5);IF(HasStatus('FLURRY_PRONE',context.Source) and not SavingThrow(Ability.Dexterity, SourceSpellDC())):ApplyStatus(PRONE,100,1);IF(HasStatus('FLURRY_BONK',context.Source)):ApplyStatus(BONK,100,2)"
data "StatsFunctorContext" "OnAttack"



// Original
//new entry "OpenHandTechnique"
//type "PassiveData"
//data "DisplayName" "Open Hand Technique"
//data "Description" "Manipulate your enemy's ki when you harness your own. Whenever you hit a creature with one of the attacks granted by your Flurry of Blows, you can impose an effect on the target."
//data "Properties" "OncePerTurn;IsHidden"
//data "Conditions" "IsFlurry() and HasDamageEffectFlag(DamageFlags.Hit)"
//data "StatsFunctors" "IF(HasStatus('FLURRY_PUSH',context.Source) and not SavingThrow(Ability.Strength, SourceSpellDC())):Force(4.5);IF(HasStatus('FLURRY_PRONE',context.Source) and not SavingThrow(Ability.Dexterity, SourceSpellDC())):ApplyStatus(PRONE,100,1);IF(HasStatus('FLURRY_BONK',context.Source)):ApplyStatus(BONK,100,2)"
//data "StatsFunctorContext" "OnAttack"

new entry "FLURRY_BONK"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Bonk Status"
data "Description" "You are going to Bonk someone!"
data "StackId" "OPENHAND"
data "Icon" "statIcons_Dazed"

new entry "FLURRY_PUSH"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Push Status"
data "Description" "You are going to Push someone!"
data "StackId" "OPENHAND"
data "Icon" "Action_Shove"

new entry "FLURRY_PRONE"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Trip Status"
data "Description" "You are going to Trip someone!"
data "StackId" "OPENHAND"
data "Icon" "Action_Topple"

new entry "BONK"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "*BONK*"
data "Description" "You bonked someone. They can't take reactions this turn."
data "Icon" "Action_KnockOut"
data "StillAnimationType" "Weakened"
data "StillAnimationPriority" "Weakened"
data "StackId" "BONK"
data "TickType" "StartTurn"
data "Boosts" "ActionResourceBlock(ReactionActionPoint)"

new entry "WholenessOfBody"
type "PassiveData"
data "DisplayName" "Wholeness of Body"
data "Description" "As an action, you can regain Hit Points equal to three times your monk level. You must finish a Long Rest before you can use this feature again."
data "Icon" "Spell_Necromancy_FalseLife"
data "Boosts" "UnlockSpell(Shout_WholeBody)"

new entry "Shout_WholeBody"
type "SpellData"
data "SpellType" "Shout"
data "Cooldown" "OncePerRest"
data "SpellProperties" "RegainHitPoints(3*Level)"
data "TargetConditions" "Self()"
data "Icon" "Spell_Necromancy_FalseLife"
data "DisplayName" "Wholeness of Body"
data "Description" "As an action, you can regain Hit Points equal to three times your monk level. You must finish a Long Rest before you can use this feature again."
data "DescriptionParams" "RegainHitPoints(3*Level);"
data "TooltipDamageList" "RegainHitPoints(3*Level)"
data "CastTextEvent" "Cast"
data "CastSound" "Action_Cast_PreserveLife"
data "TargetSound" "Action_Impact_PreserveLife"
data "UseCosts" "ActionPoint:1"
data "SpellAnimation" "414bbf02-2918-4f01-83fb-1ddc7a588d88(SPL_Arcane_Healing_01_Prepare),,;,,;7abe77ed-9c77-4eac-872c-5b8caed070b6(SPL_Somatic_Aoe_Rise_01_Cast),,;cb171bda-f065-4520-b470-e447f678ba1f(SPL_Somatic_Aoe_Rise_01_Recover),,;0c5dcc83-fa78-41da-b6a5-440b5ea30936(SPL_Arcane_Healing_01_Loop),,;,,"
data "VerbalIntent" "Healing"
data "SpellStyleGroup" "Class"
data "HitAnimationType" "MagicalNonDamage"
data "PrepareEffect" "1406899b-9de3-426b-9251-9e7d3bfacedf"
data "CastEffect" "df9ffd5a-deb8-4a27-8e37-e7f688579fd4"
data "TargetEffect" "89952943-fe61-452d-81af-d0a936544231"

new entry "Tranquility"
type "PassiveData"
data "DisplayName" "Tranquility"
data "Description" "When you finish a Long Rest you gain the effects of a Sanctuary Spell until your next Long Rest or you take a hostile action."
data "Icon" "Spell_Enchantment_Bless"
data "Boosts" "ApplyStatus(SELF,SANCTUARY_TECHNICAL,100,-1)"
data "BoostContext" "OnRest"

new entry "SANCTUARY_TECHNICAL"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Sanctuary"
data "Icon" "Spell_Enchantment_Bless"
data "Description" "When you are targeted by an attack or spell the attacker makes a wisdom saving throw or can't complete the action."
data "AuraRadius" "70"
data "AuraStatus" "TARGET:IF(Enemy() and not SavingThrow(Ability.Wisdom, SourceSpellDC(), context.Source)):ApplyStatus(SANCTUARY_ATTACKER,100,1)"
data "RemoveConditions" "(IsAttack() and IsEnemy()) or (IsSpell and IsEnemy()) or (IsEnemy() and TotalDamageDoneGreaterThan(0))"
data "RemoveFunctors" "OnAttack;OnSpellCast"

new entry "SANCTUARY_ATTACKER"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "Failed Sanctuary Save"
data "Description" "Cannot attack Monk 1 turn."
data "Icon" "Spell_Enchantment_Bane"
data "SoundLoop" "Spell_Status_Control_MO"
data "StackId" "SANCTUARY_ATT"
data "Boosts" "CannotHarmCauseEntity(context.Source)"
data "TickType" "EndTurn"
data "StatusGroups" "SG_Condition"
